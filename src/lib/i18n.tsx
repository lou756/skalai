import { createContext, useContext, useState, useCallback, type ReactNode } from 'react';

export type Locale = 'fr' | 'en';

const translations = {
  fr: {
    // Header
    'nav.howItWorks': 'Comment Ã§a marche',
    'nav.about': 'Ã€ propos',
    // Hero
    'hero.subtitle': 'Smart Knowledge for Analytics & Launch',
    'hero.tagline': 'Votre copilote IA pour SEO, indexation et visibilitÃ© web.',
    // Search
    'search.placeholder': 'Entrez l\'URL de votre site (ex: example.com)',
    'search.button': 'Analyser',
    'search.loading': 'Analyse...',
    'search.urlRequired': 'URL requise',
    'search.urlRequiredDesc': 'Veuillez entrer l\'URL du site Ã  analyser.',
    'search.complete': 'Analyse terminÃ©e',
    'search.scoreResult': 'Score SEO : {score}/100 â€” {fixes} fichier(s) gÃ©nÃ©rÃ©(s)',
    'search.error': 'Erreur d\'analyse',
    'search.errorDesc': 'Impossible d\'analyser ce site.',
    'search.genericError': 'Erreur',
    'search.genericErrorDesc': 'Une erreur est survenue lors de l\'analyse.',
    // Empty state
    'empty.title': 'Entrez l\'URL d\'un site pour lancer l\'analyse SEO',
    'empty.subtitle': 'SKAL IA analysera, gÃ©nÃ©rera les corrections et produira un rapport complet.',
    // Results
    'results.analyzedUrl': 'Analyse de',
    'results.issues': 'ProblÃ¨mes dÃ©tectÃ©s',
    'results.noIssues': 'ðŸŽ‰ Excellent ! Aucun problÃ¨me SEO majeur dÃ©tectÃ©.',
    'results.highPriority': 'Haute prioritÃ©',
    'results.mediumPriority': 'PrioritÃ© moyenne',
    'results.lowPriority': 'Basse prioritÃ©',
    // Score
    'score.title': 'Score de visibilitÃ© SEO',
    'score.excellent': 'Excellent',
    'score.good': 'Bon',
    'score.needsWork': 'Ã€ amÃ©liorer',
    'score.critical': 'Critique',
    // Score breakdown
    'score.breakdown': 'DÃ©tail du score',
    // Confidence
    'confidence.title': 'Niveau de confiance',
    'confidence.verified': 'VÃ©rifiÃ©',
    'confidence.partial': 'Partiel',
    'confidence.uncertain': 'Incertain',
    'confidence.notChecked': 'Non vÃ©rifiÃ©',
    // Checklist
    'checklist.title': 'Checklist SEO',
    'checklist.validated': 'validÃ©s',
    'checklist.titlePresent': 'Balise title prÃ©sente',
    'checklist.descPresent': 'Meta description prÃ©sente',
    'checklist.h1Unique': 'Balise H1 unique',
    'checklist.langDefined': 'Attribut lang dÃ©fini',
    'checklist.canonical': 'URL canonique dÃ©finie',
    'checklist.robotsTxt': 'Fichier robots.txt prÃ©sent',
    'checklist.sitemap': 'Sitemap XML trouvÃ©',
    'checklist.sitemapValid': 'Structure sitemap valide',
    'checklist.ogTags': 'Balises Open Graph',
    'checklist.twitterCards': 'Twitter Cards',
    'checklist.viewport': 'Meta viewport (mobile)',
    'checklist.indexable': 'Page indexable',
    'checklist.nobrokenLinks': 'Aucun lien cassÃ©',
    // Action report
    'report.title': 'Rapport d\'actions',
    'report.automated': 'Actions automatiques',
    'report.manual': 'Actions manuelles requises',
    'report.priorityHigh': 'Haute',
    'report.priorityMedium': 'Moyenne',
    'report.priorityLow': 'Basse',
    // Generated fixes
    'fixes.title': 'Fichiers gÃ©nÃ©rÃ©s automatiquement',
    'fixes.preview': 'AperÃ§u',
    'fixes.hide': 'Masquer',
    'fixes.autoGenerated': 'âœ… Auto-gÃ©nÃ©rÃ©',
    'fixes.needsReview': 'ðŸ“ Ã€ vÃ©rifier',
    // Issues
    'issue.whyProblem': 'âŒ Pourquoi c\'est un problÃ¨me',
    'issue.howToFix': 'âœ… Comment corriger',
    'issue.highPriority': 'Haute prioritÃ©',
    'issue.mediumPriority': 'PrioritÃ© moyenne',
    'issue.lowPriority': 'Basse prioritÃ©',
    'issue.manual': 'Correction manuelle',
    'issue.automated': 'Automatisable',
    'issue.semiAutomated': 'Semi-automatisÃ©',
    // Detail sections
    'detail.brokenLinks': 'Liens cassÃ©s',
    'detail.gscInstructions': 'Instructions Google Search Console',
    'detail.sitemapInfo': 'Informations Sitemap',
    'detail.sitemapUrl': 'URL du sitemap',
    'detail.sitemapUrls': 'URLs dans le sitemap',
    'detail.sitemapValid': 'Structure valide',
    'detail.yes': 'Oui',
    'detail.no': 'Non',
    'detail.contentAnalysis': 'Analyse du contenu',
    'detail.wordCount': 'Nombre de mots',
    'detail.readability': 'Score de lisibilitÃ©',
    'detail.topKeywords': 'Mots-clÃ©s principaux',
    'detail.duplicateContent': 'âš ï¸ Contenu dupliquÃ© dÃ©tectÃ©',
    'detail.duplicateSections': 'section(s) rÃ©pÃ©tÃ©e(s)',
    'detail.aiSuggestions': 'Suggestions IA',
    'detail.suggestedTitle': 'ðŸ’¡ Titre suggÃ©rÃ©',
    'detail.suggestedDesc': 'ðŸ’¡ Meta description suggÃ©rÃ©e',
    'detail.improvements': 'ðŸš€ AmÃ©liorations recommandÃ©es',
    'detail.multilingual': 'Analyse multilingue',
    'detail.langVersions': 'Versions linguistiques dÃ©tectÃ©es',
    'detail.merchant': 'Analyse Google Merchant Center',
    'detail.structuredDataFound': 'âœ… DonnÃ©es structurÃ©es Product (JSON-LD) dÃ©tectÃ©es',
    'detail.noStructuredData': 'âš ï¸ Aucune donnÃ©e structurÃ©e Product dÃ©tectÃ©e',
    'detail.merchantGuide': 'Guide Google Merchant Center',
    'detail.inStock': 'En stock',
    'detail.outOfStock': 'Rupture',
    'detail.availability': 'DisponibilitÃ©',
    'detail.noName': 'Produit sans nom',
    // Footer
    'footer.tagline': 'SKAL IA â€” Votre copilote IA pour SEO, indexation et visibilitÃ© web.',
    // Errors
    'error.inaccessible': 'Inaccessible',
    'error.code': 'Erreur',
  },
  en: {
    'nav.howItWorks': 'How it works',
    'nav.about': 'About',
    'hero.subtitle': 'Smart Knowledge for Analytics & Launch',
    'hero.tagline': 'Your AI copilot for SEO, indexing and web visibility.',
    'search.placeholder': 'Enter your website URL (e.g. example.com)',
    'search.button': 'Analyze',
    'search.loading': 'Analyzing...',
    'search.urlRequired': 'URL required',
    'search.urlRequiredDesc': 'Please enter the URL of the site to analyze.',
    'search.complete': 'Analysis complete',
    'search.scoreResult': 'SEO Score: {score}/100 â€” {fixes} file(s) generated',
    'search.error': 'Analysis error',
    'search.errorDesc': 'Unable to analyze this site.',
    'search.genericError': 'Error',
    'search.genericErrorDesc': 'An error occurred during analysis.',
    'empty.title': 'Enter a website URL to start the SEO analysis',
    'empty.subtitle': 'SKAL IA will analyze, generate fixes and produce a comprehensive report.',
    'results.analyzedUrl': 'Analysis of',
    'results.issues': 'Issues detected',
    'results.noIssues': 'ðŸŽ‰ Excellent! No major SEO issues detected.',
    'results.highPriority': 'High priority',
    'results.mediumPriority': 'Medium priority',
    'results.lowPriority': 'Low priority',
    'score.title': 'SEO Visibility Score',
    'score.excellent': 'Excellent',
    'score.good': 'Good',
    'score.needsWork': 'Needs improvement',
    'score.critical': 'Critical',
    'score.breakdown': 'Score breakdown',
    'confidence.title': 'Confidence level',
    'confidence.verified': 'Verified',
    'confidence.partial': 'Partial',
    'confidence.uncertain': 'Uncertain',
    'confidence.notChecked': 'Not checked',
    'checklist.title': 'SEO Checklist',
    'checklist.validated': 'validated',
    'checklist.titlePresent': 'Title tag present',
    'checklist.descPresent': 'Meta description present',
    'checklist.h1Unique': 'Unique H1 tag',
    'checklist.langDefined': 'Language attribute defined',
    'checklist.canonical': 'Canonical URL defined',
    'checklist.robotsTxt': 'robots.txt file present',
    'checklist.sitemap': 'XML Sitemap found',
    'checklist.sitemapValid': 'Valid sitemap structure',
    'checklist.ogTags': 'Open Graph tags',
    'checklist.twitterCards': 'Twitter Cards',
    'checklist.viewport': 'Viewport meta (mobile)',
    'checklist.indexable': 'Page indexable',
    'checklist.nobrokenLinks': 'No broken links',
    'report.title': 'Action Report',
    'report.automated': 'Automated actions',
    'report.manual': 'Manual actions required',
    'report.priorityHigh': 'High',
    'report.priorityMedium': 'Medium',
    'report.priorityLow': 'Low',
    'fixes.title': 'Auto-generated files',
    'fixes.preview': 'Preview',
    'fixes.hide': 'Hide',
    'fixes.autoGenerated': 'âœ… Auto-generated',
    'fixes.needsReview': 'ðŸ“ Needs review',
    'issue.whyProblem': 'âŒ Why this is a problem',
    'issue.howToFix': 'âœ… How to fix',
    'issue.highPriority': 'High priority',
    'issue.mediumPriority': 'Medium priority',
    'issue.lowPriority': 'Low priority',
    'issue.manual': 'Manual fix',
    'issue.automated': 'Automatable',
    'issue.semiAutomated': 'Semi-automated',
    'detail.brokenLinks': 'Broken links',
    'detail.gscInstructions': 'Google Search Console Instructions',
    'detail.sitemapInfo': 'Sitemap Information',
    'detail.sitemapUrl': 'Sitemap URL',
    'detail.sitemapUrls': 'URLs in sitemap',
    'detail.sitemapValid': 'Valid structure',
    'detail.yes': 'Yes',
    'detail.no': 'No',
    'detail.contentAnalysis': 'Content Analysis',
    'detail.wordCount': 'Word count',
    'detail.readability': 'Readability score',
    'detail.topKeywords': 'Top keywords',
    'detail.duplicateContent': 'âš ï¸ Duplicate content detected',
    'detail.duplicateSections': 'repeated section(s)',
    'detail.aiSuggestions': 'AI Suggestions',
    'detail.suggestedTitle': 'ðŸ’¡ Suggested title',
    'detail.suggestedDesc': 'ðŸ’¡ Suggested meta description',
    'detail.improvements': 'ðŸš€ Recommended improvements',
    'detail.multilingual': 'Multilingual Analysis',
    'detail.langVersions': 'Detected language versions',
    'detail.merchant': 'Google Merchant Center Analysis',
    'detail.structuredDataFound': 'âœ… Product structured data (JSON-LD) detected',
    'detail.noStructuredData': 'âš ï¸ No Product structured data detected',
    'detail.merchantGuide': 'Google Merchant Center Guide',
    'detail.inStock': 'In stock',
    'detail.outOfStock': 'Out of stock',
    'detail.availability': 'Availability',
    'detail.noName': 'Unnamed product',
    'footer.tagline': 'SKAL IA â€” Your AI copilot for SEO, indexing and web visibility.',
    'error.inaccessible': 'Inaccessible',
    'error.code': 'Error',
  },
} as const;

type TranslationKey = keyof typeof translations.fr;

interface I18nContextType {
  locale: Locale;
  setLocale: (locale: Locale) => void;
  t: (key: TranslationKey, params?: Record<string, string | number>) => string;
}

const I18nContext = createContext<I18nContextType | null>(null);

export function I18nProvider({ children }: { children: ReactNode }) {
  const [locale, setLocale] = useState<Locale>('fr');

  const t = useCallback((key: TranslationKey, params?: Record<string, string | number>): string => {
    let text: string = translations[locale]?.[key] || translations.fr[key] || key;
    if (params) {
      Object.entries(params).forEach(([k, v]) => {
        text = text.replace(`{${k}}`, String(v));
      });
    }
    return text;
  }, [locale]);

  return (
    <I18nContext.Provider value={{ locale, setLocale, t }}>
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
}
